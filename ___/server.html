<!DOCTYPE html>
<html>
	<head>
		<title>Server View</title>
		<script type="text/javascript">
			var pr,socket;
			function join(){
				socket=new WebSocket("ws://192.168.178.73:8021/");
				socket.onopen=function(){
					console.clear();
					if (document.cookie.length>0){
						this.send(`cmd:${document.cookie}`)
					}
				}
				socket.onclose=function(){
					join();
				}
				socket.onmessage=async function(e){
					if (typeof e.data=="object"){
						e=await e.data.text();
					}
					else{
						e=e.data;
					}
					dt=e.substr(e.split(":")[0].length+1);
					switch (e.split(":")[0]){
						case "null":
							return;
						case "cmd":
							if (dt=="0"){
								console.warn("Switch Failure");
							}
							else{
								document.cookie=dt.substr(1);
								pr.innerHTML="";
							}
							return;
						case "out":
						case "err":
							pr.innerHTML+=`<span class="row ${e.substr(0,3)}">${dt.split("\n").join("</span>\n<span class=\"row "+e.substr(0,3)+"\">")}</span>`;
							pr.scroll(0,pr.scrollHeight);
							return;
						default:
							console.warn("Unhandled Message: "+e);
					}
				}
				socket.onerror=function(e){
					e.stopImmediatePropagation();
					e.stopPropagation();
					e.preventDefault();
				}
			}
			window.onload=function(){
				pr=document.querySelectorAll(".cmd")[0];
				pr.innerHTML="";
				join();
			}
		</script>
		<style type="text/css">
			body {
				overflow: hidden;
			}
			body, body * {
				padding: 0;
				margin: 0;
			}
			.cmd {
				position: absolute;
				top: 0;
				left: 0;
				width: 100%;
				height: 100%;
				background: #0a0a0a;
				color: #f3f3f3;
				white-space: pre-wrap;
				font-family: Consolas;
				overflow-y: scroll;
			}
		</style>
	</head>
	<body>
		<pre class="cmd">
		</pre>
	</body>
</html>
